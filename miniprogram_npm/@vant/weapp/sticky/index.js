"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var utils_1=require("../common/utils"),component_1=require("../common/component"),validator_1=require("../common/validator"),page_scroll_1=require("../mixins/page-scroll"),ROOT_ELEMENT=".van-sticky";(0,component_1.VantComponent)({props:{zIndex:{type:Number,value:99},offsetTop:{type:Number,value:0,observer:"onScroll"},disabled:{type:Boolean,observer:"onScroll"},container:{type:null,observer:"onScroll"},scrollTop:{type:null,observer:function(t){this.onScroll({scrollTop:t})}}},mixins:[(0,page_scroll_1.pageScrollMixin)((function(t){null==this.data.scrollTop&&this.onScroll(t)}))],data:{height:0,fixed:!1,transform:0},mounted:function(){this.onScroll()},methods:{onScroll:function(t){var e=this,o=(void 0===t?{}:t).scrollTop,i=this.data,r=i.container,n=i.offsetTop;i.disabled?this.setDataAfterDiff({fixed:!1,transform:0}):(this.scrollTop=o||this.scrollTop,"function"!=typeof r?(0,utils_1.getRect)(this,ROOT_ELEMENT).then((function(t){(0,validator_1.isDef)(t)&&(t.width||t.height)&&(n>=t.top?(e.setDataAfterDiff({fixed:!0,height:t.height}),e.transform=0):e.setDataAfterDiff({fixed:!1}))})):Promise.all([(0,utils_1.getRect)(this,ROOT_ELEMENT),this.getContainerRect()]).then((function(t){var o=t[0],i=t[1];n+o.height>i.height+i.top?e.setDataAfterDiff({fixed:!1,transform:i.height-o.height}):n>=o.top?e.setDataAfterDiff({fixed:!0,height:o.height,transform:0}):e.setDataAfterDiff({fixed:!1,transform:0})})).catch((function(){})))},setDataAfterDiff:function(t){var e=this;wx.nextTick((function(){var o=Object.keys(t).reduce((function(o,i){return t[i]!==e.data[i]&&(o[i]=t[i]),o}),{});Object.keys(o).length>0&&e.setData(o),e.$emit("scroll",{scrollTop:e.scrollTop,isFixed:t.fixed||e.data.fixed})}))},getContainerRect:function(){var t=this.data.container();return t?new Promise((function(e){return t.boundingClientRect(e).exec()})):Promise.reject(new Error("not found container"))}}});
//# sourceMappingURL=index.js.map