{"version":3,"file":"node_modules\\@vant\\weapp\\lib\\uploader\\index.js","names":["__assign","this","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","defineProperty","exports","value","component_1","require","validator_1","shared_1","utils_1","VantComponent","props","disabled","Boolean","multiple","uploadText","String","useBeforeRead","afterRead","beforeRead","previewSize","type","name","accept","fileList","Array","observer","maxSize","Number","MAX_VALUE","maxCount","deletable","showUpload","previewImage","previewFullImage","videoFit","imageFit","uploadIcon","imageProps","videoProps","mediaProps","messageFileProps","data","lists","isInCount","methods","formatFileList","_a","_b","map","item","isImage","isImageFile","isVideo","isVideoFile","isBoolean","setData","getDetail","index","startUpload","_this","chooseFile","then","res","onBeforeRead","catch","error","$emit","file","Promise","resolve","reject","callback","ok","isPromise","onAfterRead","isArray","some","size","deleteItem","event","currentTarget","dataset","onPreviewImage","showmenu","wx","urls","filter","url","current","fail","showToast","title","icon","onPreviewVideo","sources","reduce","sum","cur","curIndex","push","previewMedia","onPreviewFile","openDocument","filePath","showMenu","onClickPreview"],"sources":["node_modules\\@vant\\weapp\\lib\\uploader\\index.js"],"sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar component_1 = require(\"../common/component\");\nvar validator_1 = require(\"../common/validator\");\nvar shared_1 = require(\"./shared\");\nvar utils_1 = require(\"./utils\");\n(0, component_1.VantComponent)({\n    props: __assign(__assign(__assign(__assign({ disabled: Boolean, multiple: Boolean, uploadText: String, useBeforeRead: Boolean, afterRead: null, beforeRead: null, previewSize: {\n            type: null,\n            value: 80,\n        }, name: {\n            type: null,\n            value: '',\n        }, accept: {\n            type: String,\n            value: 'image',\n        }, fileList: {\n            type: Array,\n            value: [],\n            observer: 'formatFileList',\n        }, maxSize: {\n            type: Number,\n            value: Number.MAX_VALUE,\n        }, maxCount: {\n            type: Number,\n            value: 100,\n        }, deletable: {\n            type: Boolean,\n            value: true,\n        }, showUpload: {\n            type: Boolean,\n            value: true,\n        }, previewImage: {\n            type: Boolean,\n            value: true,\n        }, previewFullImage: {\n            type: Boolean,\n            value: true,\n        }, videoFit: {\n            type: String,\n            value: 'contain',\n        }, imageFit: {\n            type: String,\n            value: 'scaleToFill',\n        }, uploadIcon: {\n            type: String,\n            value: 'photograph',\n        } }, shared_1.imageProps), shared_1.videoProps), shared_1.mediaProps), shared_1.messageFileProps),\n    data: {\n        lists: [],\n        isInCount: true,\n    },\n    methods: {\n        formatFileList: function () {\n            var _a = this.data, _b = _a.fileList, fileList = _b === void 0 ? [] : _b, maxCount = _a.maxCount;\n            var lists = fileList.map(function (item) { return (__assign(__assign({}, item), { isImage: (0, utils_1.isImageFile)(item), isVideo: (0, utils_1.isVideoFile)(item), deletable: (0, validator_1.isBoolean)(item.deletable) ? item.deletable : true })); });\n            this.setData({ lists: lists, isInCount: lists.length < maxCount });\n        },\n        getDetail: function (index) {\n            return {\n                name: this.data.name,\n                index: index == null ? this.data.fileList.length : index,\n            };\n        },\n        startUpload: function () {\n            var _this = this;\n            var _a = this.data, maxCount = _a.maxCount, multiple = _a.multiple, lists = _a.lists, disabled = _a.disabled;\n            if (disabled)\n                return;\n            (0, utils_1.chooseFile)(__assign(__assign({}, this.data), { maxCount: maxCount - lists.length }))\n                .then(function (res) {\n                _this.onBeforeRead(multiple ? res : res[0]);\n            })\n                .catch(function (error) {\n                _this.$emit('error', error);\n            });\n        },\n        onBeforeRead: function (file) {\n            var _this = this;\n            var _a = this.data, beforeRead = _a.beforeRead, useBeforeRead = _a.useBeforeRead;\n            var res = true;\n            if (typeof beforeRead === 'function') {\n                res = beforeRead(file, this.getDetail());\n            }\n            if (useBeforeRead) {\n                res = new Promise(function (resolve, reject) {\n                    _this.$emit('before-read', __assign(__assign({ file: file }, _this.getDetail()), { callback: function (ok) {\n                            ok ? resolve() : reject();\n                        } }));\n                });\n            }\n            if (!res) {\n                return;\n            }\n            if ((0, validator_1.isPromise)(res)) {\n                res.then(function (data) { return _this.onAfterRead(data || file); });\n            }\n            else {\n                this.onAfterRead(file);\n            }\n        },\n        onAfterRead: function (file) {\n            var _a = this.data, maxSize = _a.maxSize, afterRead = _a.afterRead;\n            var oversize = Array.isArray(file)\n                ? file.some(function (item) { return item.size > maxSize; })\n                : file.size > maxSize;\n            if (oversize) {\n                this.$emit('oversize', __assign({ file: file }, this.getDetail()));\n                return;\n            }\n            if (typeof afterRead === 'function') {\n                afterRead(file, this.getDetail());\n            }\n            this.$emit('after-read', __assign({ file: file }, this.getDetail()));\n        },\n        deleteItem: function (event) {\n            var index = event.currentTarget.dataset.index;\n            this.$emit('delete', __assign(__assign({}, this.getDetail(index)), { file: this.data.fileList[index] }));\n        },\n        onPreviewImage: function (event) {\n            if (!this.data.previewFullImage)\n                return;\n            var index = event.currentTarget.dataset.index;\n            var _a = this.data, lists = _a.lists, showmenu = _a.showmenu;\n            var item = lists[index];\n            wx.previewImage({\n                urls: lists.filter(function (item) { return (0, utils_1.isImageFile)(item); }).map(function (item) { return item.url; }),\n                current: item.url,\n                showmenu: showmenu,\n                fail: function () {\n                    wx.showToast({ title: '预览图片失败', icon: 'none' });\n                },\n            });\n        },\n        onPreviewVideo: function (event) {\n            if (!this.data.previewFullImage)\n                return;\n            var index = event.currentTarget.dataset.index;\n            var lists = this.data.lists;\n            var sources = [];\n            var current = lists.reduce(function (sum, cur, curIndex) {\n                if (!(0, utils_1.isVideoFile)(cur)) {\n                    return sum;\n                }\n                sources.push(__assign(__assign({}, cur), { type: 'video' }));\n                if (curIndex < index) {\n                    sum++;\n                }\n                return sum;\n            }, 0);\n            wx.previewMedia({\n                sources: sources,\n                current: current,\n                fail: function () {\n                    wx.showToast({ title: '预览视频失败', icon: 'none' });\n                },\n            });\n        },\n        onPreviewFile: function (event) {\n            var index = event.currentTarget.dataset.index;\n            wx.openDocument({\n                filePath: this.data.lists[index].url,\n                showMenu: true,\n            });\n        },\n        onClickPreview: function (event) {\n            var index = event.currentTarget.dataset.index;\n            var item = this.data.lists[index];\n            this.$emit('click-preview', __assign(__assign({}, item), this.getDetail(index)));\n        },\n    },\n});\n"],"mappings":"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","ignoreList":[]}