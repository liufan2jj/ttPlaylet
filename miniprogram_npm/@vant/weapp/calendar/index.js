"use strict";var __spreadArray=this&&this.__spreadArray||function(t,e,a){if(a||2===arguments.length)for(var i,n=0,o=e.length;n<o;n++)!i&&n in e||(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("../common/component"),utils_1=require("./utils"),toast_1=__importDefault(require("../toast/toast")),utils_2=require("../common/utils"),initialMinDate=(0,utils_1.getToday)().getTime(),initialMaxDate=function(){var t=(0,utils_1.getToday)();return new Date(t.getFullYear(),t.getMonth()+6,t.getDate()).getTime()}(),getTime=function(t){return t instanceof Date?t.getTime():t};(0,component_1.VantComponent)({props:{title:{type:String,value:"日期选择"},color:String,show:{type:Boolean,observer:function(t){t&&(this.initRect(),this.scrollIntoView())}},formatter:null,confirmText:{type:String,value:"确定"},confirmDisabledText:{type:String,value:"确定"},rangePrompt:String,showRangePrompt:{type:Boolean,value:!0},defaultDate:{type:null,value:(0,utils_1.getToday)().getTime(),observer:function(t){this.setData({currentDate:t}),this.scrollIntoView()}},allowSameDay:Boolean,type:{type:String,value:"single",observer:"reset"},minDate:{type:Number,value:initialMinDate},maxDate:{type:Number,value:initialMaxDate},position:{type:String,value:"bottom"},rowHeight:{type:null,value:utils_1.ROW_HEIGHT},round:{type:Boolean,value:!0},poppable:{type:Boolean,value:!0},showMark:{type:Boolean,value:!0},showTitle:{type:Boolean,value:!0},showConfirm:{type:Boolean,value:!0},showSubtitle:{type:Boolean,value:!0},safeAreaInsetBottom:{type:Boolean,value:!0},closeOnClickOverlay:{type:Boolean,value:!0},maxRange:{type:null,value:null},minRange:{type:Number,value:1},firstDayOfWeek:{type:Number,value:0},readonly:Boolean,rootPortal:{type:Boolean,value:!1}},data:{subtitle:"",currentDate:null,scrollIntoView:""},watch:{minDate:function(){this.initRect()},maxDate:function(){this.initRect()}},created:function(){this.setData({currentDate:this.getInitialDate(this.data.defaultDate)})},mounted:function(){!this.data.show&&this.data.poppable||(this.initRect(),this.scrollIntoView())},methods:{reset:function(){this.setData({currentDate:this.getInitialDate(this.data.defaultDate)}),this.scrollIntoView()},initRect:function(){var t=this;null!=this.contentObserver&&this.contentObserver.disconnect();var e=this.createIntersectionObserver({thresholds:[0,.1,.9,1],observeAll:!0});this.contentObserver=e,e.relativeTo(".van-calendar__body"),e.observe(".month",(function(e){e.boundingClientRect.top<=e.relativeRect.top&&t.setData({subtitle:(0,utils_1.formatMonthTitle)(e.dataset.date)})}))},limitDateRange:function(t,e,a){return void 0===e&&(e=null),void 0===a&&(a=null),e=e||this.data.minDate,a=a||this.data.maxDate,-1===(0,utils_1.compareDay)(t,e)?e:1===(0,utils_1.compareDay)(t,a)?a:t},getInitialDate:function(t){var e=this;void 0===t&&(t=null);var a=this.data,i=a.type,n=a.minDate,o=a.maxDate,r=a.allowSameDay;if(!t)return[];var s=(0,utils_1.getToday)().getTime();if("range"===i){Array.isArray(t)||(t=[]);var l=t||[],u=l[0],c=l[1],m=getTime(u||s),h=this.limitDateRange(m,n,r?m:(0,utils_1.getPrevDay)(new Date(o)).getTime()),p=getTime(c||s);return[h,this.limitDateRange(p,r?p:(0,utils_1.getNextDay)(new Date(n)).getTime())]}return"multiple"===i?Array.isArray(t)?t.map((function(t){return e.limitDateRange(t)})):[this.limitDateRange(s)]:(t&&!Array.isArray(t)||(t=s),this.limitDateRange(t))},scrollIntoView:function(){var t=this;(0,utils_2.requestAnimationFrame)((function(){var e=t.data,a=e.currentDate,i=e.type,n=e.show,o=e.poppable,r=e.minDate,s=e.maxDate;if(a){var l="single"===i?a:a[0];if(l&&(n||!o))(0,utils_1.getMonths)(r,s).some((function(e,a){return 0===(0,utils_1.compareMonth)(e,l)&&(t.setData({scrollIntoView:"month".concat(a)}),!0)}))}}))},onOpen:function(){this.$emit("open")},onOpened:function(){this.$emit("opened")},onClose:function(){this.$emit("close")},onClosed:function(){this.$emit("closed")},onClickDay:function(t){if(!this.data.readonly){var e=t.detail.date,a=this.data,i=a.type,n=a.currentDate,o=a.allowSameDay;if("range"===i){var r=n[0],s=n[1];if(r&&!s){var l=(0,utils_1.compareDay)(e,r);if(1===l){var u=this.selectComponent(".month").data.days;u.some((function(t,a){var i="disabled"===t.type&&getTime(r)<getTime(t.date)&&getTime(t.date)<getTime(e);return i&&(e=u[a-1].date),i})),this.select([r,e],!0)}else-1===l?this.select([e,null]):o&&this.select([e,e],!0)}else this.select([e,null])}else if("multiple"===i){var c;if(n.some((function(t,a){var i=0===(0,utils_1.compareDay)(t,e);return i&&(c=a),i}))){var m=n.splice(c,1);this.setData({currentDate:n}),this.unselect(m)}else this.select(__spreadArray(__spreadArray([],n,!0),[e],!1))}else this.select(e,!0)}},unselect:function(t){var e=t[0];e&&this.$emit("unselect",(0,utils_1.copyDates)(e))},select:function(t,e){if(e&&"range"===this.data.type&&!this.checkRange(t))return void(this.data.showConfirm?this.emit([t[0],(0,utils_1.getDayByOffset)(t[0],this.data.maxRange-1)]):this.emit(t));this.emit(t),e&&!this.data.showConfirm&&this.onConfirm()},emit:function(t){this.setData({currentDate:Array.isArray(t)?t.map(getTime):getTime(t)}),this.$emit("select",(0,utils_1.copyDates)(t))},checkRange:function(t){var e=this.data,a=e.maxRange,i=e.rangePrompt,n=e.showRangePrompt;return!(a&&(0,utils_1.calcDateNum)(t)>a)||(n&&(0,toast_1.default)({context:this,message:i||"选择天数不能超过 ".concat(a," 天")}),this.$emit("over-range"),!1)},onConfirm:function(){var t=this;("range"!==this.data.type||this.checkRange(this.data.currentDate))&&wx.nextTick((function(){t.$emit("confirm",(0,utils_1.copyDates)(t.data.currentDate))}))},onClickSubtitle:function(t){this.$emit("click-subtitle",t)}}});
//# sourceMappingURL=index.js.map