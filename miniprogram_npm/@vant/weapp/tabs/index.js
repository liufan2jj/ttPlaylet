"use strict";var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var a in e=arguments[i])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},__assign.apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0});var component_1=require("../common/component"),touch_1=require("../mixins/touch"),utils_1=require("../common/utils"),validator_1=require("../common/validator"),relation_1=require("../common/relation");(0,component_1.VantComponent)({mixins:[touch_1.touch],classes:["nav-class","tab-class","tab-active-class","line-class","wrap-class"],relation:(0,relation_1.useChildren)("tab",(function(){this.updateTabs()})),props:{sticky:Boolean,border:Boolean,swipeable:Boolean,titleActiveColor:String,titleInactiveColor:String,color:String,animated:{type:Boolean,observer:function(){var t=this;this.children.forEach((function(e,i){return e.updateRender(i===t.data.currentIndex,t)}))}},lineWidth:{type:null,value:40,observer:"resize"},lineHeight:{type:null,value:-1},active:{type:null,value:0,observer:function(t){t!==this.getCurrentName()&&this.setCurrentIndexByName(t)}},type:{type:String,value:"line"},ellipsis:{type:Boolean,value:!0},duration:{type:Number,value:.3},zIndex:{type:Number,value:1},swipeThreshold:{type:Number,value:5,observer:function(t){this.setData({scrollable:this.children.length>t||!this.data.ellipsis})}},offsetTop:{type:Number,value:0},lazyRender:{type:Boolean,value:!0},useBeforeChange:{type:Boolean,value:!1}},data:{tabs:[],scrollLeft:0,scrollable:!1,currentIndex:0,container:null,skipTransition:!0,scrollWithAnimation:!1,lineOffsetLeft:0,inited:!1},mounted:function(){var t=this;(0,utils_1.requestAnimationFrame)((function(){t.swiping=!0,t.setData({container:function(){return t.createSelectorQuery().select(".van-tabs")}}),t.resize(),t.scrollIntoView()}))},methods:{updateTabs:function(){var t=this.children,e=void 0===t?[]:t,i=this.data;this.setData({tabs:e.map((function(t){return t.data})),scrollable:this.children.length>i.swipeThreshold||!i.ellipsis}),this.setCurrentIndexByName(i.active||this.getCurrentName())},trigger:function(t,e){var i=this.data.currentIndex,n=this.getChildData(i,e);(0,validator_1.isDef)(n)&&this.$emit(t,n)},onTap:function(t){var e=this,i=t.currentTarget.dataset.index,n=this.children[i];n.data.disabled?this.trigger("disabled",n):this.onBeforeChange(i).then((function(){e.setCurrentIndex(i),(0,utils_1.nextTick)((function(){e.trigger("click")}))}))},setCurrentIndexByName:function(t){var e=this.children,i=(void 0===e?[]:e).filter((function(e){return e.getComputedName()===t}));i.length&&this.setCurrentIndex(i[0].index)},setCurrentIndex:function(t){var e=this,i=this.data,n=this.children,a=void 0===n?[]:n;if(!(!(0,validator_1.isDef)(t)||t>=a.length||t<0))if((0,utils_1.groupSetData)(this,(function(){a.forEach((function(i,n){var a=n===t;a===i.data.active&&i.inited||i.updateRender(a,e)}))})),t!==i.currentIndex){var r=null!==i.currentIndex;this.setData({currentIndex:t}),(0,utils_1.requestAnimationFrame)((function(){e.resize(),e.scrollIntoView()})),(0,utils_1.nextTick)((function(){e.trigger("input"),r&&e.trigger("change")}))}else i.inited||this.resize()},getCurrentName:function(){var t=this.children[this.data.currentIndex];if(t)return t.getComputedName()},resize:function(){var t=this;if("line"===this.data.type){var e=this.data,i=e.currentIndex,n=e.ellipsis,a=e.skipTransition;Promise.all([(0,utils_1.getAllRect)(this,".van-tab"),(0,utils_1.getRect)(this,".van-tabs__line")]).then((function(e){var r=e[0],s=void 0===r?[]:r,o=e[1],l=s[i];if(null!=l){var u=s.slice(0,i).reduce((function(t,e){return t+e.width}),0);u+=(l.width-o.width)/2+(n?0:8),t.setData({lineOffsetLeft:u,inited:!0}),t.swiping=!0,a&&setTimeout((function(){t.setData({skipTransition:!1})}),t.data.duration)}}))}},scrollIntoView:function(){var t=this,e=this.data,i=e.currentIndex,n=e.scrollable,a=e.scrollWithAnimation;n&&Promise.all([(0,utils_1.getAllRect)(this,".van-tab"),(0,utils_1.getRect)(this,".van-tabs__nav")]).then((function(e){var n=e[0],r=e[1],s=n[i],o=n.slice(0,i).reduce((function(t,e){return t+e.width}),0);t.setData({scrollLeft:o-(r.width-s.width)/2}),a||(0,utils_1.nextTick)((function(){t.setData({scrollWithAnimation:!0})}))}))},onTouchScroll:function(t){this.$emit("scroll",t.detail)},onTouchStart:function(t){this.data.swipeable&&(this.swiping=!0,this.touchStart(t))},onTouchMove:function(t){this.data.swipeable&&this.swiping&&this.touchMove(t)},onTouchEnd:function(){var t=this;if(this.data.swipeable&&this.swiping){var e=this,i=e.direction,n=e.deltaX,a=e.offsetX;if("horizontal"===i&&a>=50){var r=this.getAvaiableTab(n);-1!==r&&this.onBeforeChange(r).then((function(){return t.setCurrentIndex(r)}))}this.swiping=!1}},getAvaiableTab:function(t){for(var e=this.data,i=e.tabs,n=e.currentIndex,a=t>0?-1:1,r=a;n+r<i.length&&n+r>=0;r+=a){var s=n+r;if(s>=0&&s<i.length&&i[s]&&!i[s].disabled)return s}return-1},onBeforeChange:function(t){var e=this;return this.data.useBeforeChange?new Promise((function(i,n){e.$emit("before-change",__assign(__assign({},e.getChildData(t)),{callback:function(t){return t?i():n()}}))})):Promise.resolve()},getChildData:function(t,e){var i=e||this.children[t];if((0,validator_1.isDef)(i))return{index:i.index,name:i.getComputedName(),title:i.data.title}}}});
//# sourceMappingURL=index.js.map